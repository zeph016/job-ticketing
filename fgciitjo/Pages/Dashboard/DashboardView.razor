@page "/dashboard"

@inherits DashboardBase
@attribute [Authorize]

<div class='page-cont'>
    <MudPaper Class='page-cont__background' Square Elevation='0' Height='100%'>
        <MudContainer Class='dashboard-container pa-2' Fixed='false' MaxWidth='MaxWidth.ExtraExtraLarge'>
            @if (!dataFetched)
            {
                @* <MudOverlay Visible="isVisible" DarkBackground="true" Absolute="true">
                    <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
                    </MudOverlay> *@
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: topLCont;' />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: topLCCont;' />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: topRCCont;' />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: topRCont;' />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: centCont;' />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: bottomRCont;' />
                <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" style='grid-area: bottomCont;' />
            }
            else
            {
                <MudPaper Class='cardcont' Elevation='0' style='border-color: #008000bd;'>
                    <MudContainer Class='cardcont__subcont' Fixed='true'>
                        <MudIcon Class='cardcont__hcardicon' Icon="@Icons.Material.Filled.StickyNote2" Title='Total Tickets'
                        Size='Size.Large' />
                        <MudSpacer />
                        <div class='cardcont__hlabel'>
                            <MudText>
                                @totalTickets
                            </MudText>
                            <MudText>
                                TOTAL TICKETS
                            </MudText>
                        </div>
                    </MudContainer>
                    <MudContainer Class='cardcont__subcont' Fixed='true'>
                        <MudText Class='cardcont__lblonfooter'>
                            @* Sample *@
                        </MudText>
                        <MudSpacer />
                        <MudText>
                            @* Sample *@
                        </MudText>
                    </MudContainer>
                </MudPaper>
                <MudPaper Class='cardcont' Elevation='0' style='@($"border-color:{selectedTicketStatus.StatusColor};")'>
                    <MudContainer Class='cardcont__subcont' Fixed='true'
                    style='@($"background-color:{selectedTicketStatus.StatusColor};")'>
                        <MudIcon Class='cardcont__hcardicon' Icon="@Icons.Material.Filled.Rule" Title='Ticket Status'
                        Size='Size.Large' />
                        <MudSpacer />
                        <div class='cardcont__hlabel'>
                            <MudText>
                                @ticketStatusCount
                            </MudText>
                            <MudText>
                                BY STATUS
                            </MudText>
                        </div>
                    </MudContainer>
                    <MudContainer Class='cardcont__subcont' Fixed='true'>
                        <MudText Class='cardcont__lblonfooter'>
                            @selectedTicketStatus.StatusName
                        </MudText>
                        <MudSpacer />
                        <div>
                            <MudMenu Class='cardcont__fcardicon' Icon="@Icons.Material.Filled.Settings" Dense='true'
                            Direction='Direction.End'>
                                @foreach (var item in ticketStatusList)
                                {
                                    <MudMenuItem OnClick='@(() => CountTicketStatus(item))'>@item.StatusName</MudMenuItem>
                                }
                            </MudMenu>
                        </div>
                    </MudContainer>
                </MudPaper>
                <MudPaper Class='cardcont' Elevation='0' style='@styleStringBorderPriority'>
                    <MudContainer Class='cardcont__subcont' Fixed='true' style='@styleStringBackGPriority'>
                        <MudIcon Class='cardcont__hcardicon' Icon="@Icons.Material.Filled.LowPriority" Title='Ticket Priority'
                        Size='Size.Large' />
                        <MudSpacer />
                        <MudText Class='cardcont__hlabel'>
                            <MudText>
                                @ticketPriorityCount
                            </MudText>
                            <MudText>
                                BY PRIORITY
                            </MudText>
                        </MudText>
                    </MudContainer>
                    <MudContainer Class='cardcont__subcont' Fixed='true'>
                        <MudText Class='cardcont__lblonfooter'>
                            @selectedPriorityLevel
                        </MudText>
                        <MudSpacer />
                        <MudText>
                            <MudText>
                                <MudMenu Class='cardcont__fcardicon' Icon='@Icons.Material.Filled.Settings' Dense='true'
                                Direction='Direction.End'>
                                    @foreach (Enums.PriorityLevel item in Enum.GetValues(typeof(Enums.PriorityLevel)))
                                    {
                                        <MudMenuItem OnClick='@(() => CountTicketPriority(item))'>@item</MudMenuItem>
                                    }
                                </MudMenu>
                            </MudText>
                        </MudText>
                    </MudContainer>
                </MudPaper>
                <MudPaper Class='cardcont' Elevation='0'>
                    <MudContainer Class='cardcont__subcont' Fixed='true'>
                        <MudIcon Class='cardcont__hcardicon' Icon="@Icons.Material.Filled.NoteAdd" Title='Ticket Priority'
                        Size='Size.Large' />
                        <MudSpacer />
                        <div class='cardcont__hlabel'>
                            <MudText>
                                @ticketsForTheDayCount
                            </MudText>
                            <MudText>
                                BY DAY
                            </MudText>
                        </div>
                    </MudContainer>
                    <MudContainer Class='cardcont__subcont' Fixed='true'>
                        <MudText Class='cardcont__lblonfooter'>
                            @ticketDateString
                        </MudText>
                        <MudSpacer />
                        <div>
                            <MudDatePicker Class='cardcont__datepickercard4' @bind-Date='selectedDate' DateFormat='MM/dd/yyyy' DisableToolbar
                            PickerClosed='@(() => CountTicketsForTheDay(Convert.ToDateTime(selectedDate)))'  IconSize='Size.Small' />
                        </div>
                    </MudContainer>
                </MudPaper>

                <MudPaper Class='cardcont2' Elevation='0'>
                    <MudContainer Class='cardcont2__subcont' Fixed='false' MaxWidth='MaxWidth.ExtraExtraLarge'>
                        <MudMenu Class='cardcont2__fcardicon' Icon="@Icons.Material.Filled.Settings" Dense='true'
                        Direction='Direction.Bottom' DisableRipple='true'>
                            @foreach (var item in ticketStatusListCBList)
                            {
                                <div class='cardcont2__menucheckboxlist'>
                                    <MudCheckBox @bind-Checked='@item.IsChecked' Dense='true' Size='Size.Small' DisableRipple='false'>
                                        @item.selectedTicketStatus.StatusName
                                    </MudCheckBox>
                                </div>
                            }
                        </MudMenu>
                        <div class='cardcont2__lblonfooter'>
                            <MudIconButton OnClick='RefreshBarChart' Icon="@Icons.Material.Filled.Refresh" aria-label="Analytics"
                            Size='Size.Small' />
                        </div>
                        <MudText Class='cardcont2__cardtitle'>
                            Ticket Status
                        </MudText>
                        <MudSpacer />
                        <div class='cardcont2__lblonfooter'>
                            <MudIconButton OnClick='ViewBarChart' Icon="@Icons.Material.Filled.Analytics" aria-label="Analytics"
                            Size='Size.Small' />
                        </div>
                    </MudContainer>
                    <MudContainer Class='cardcont2__subcont' Fixed='false' MaxWidth='MaxWidth.ExtraExtraLarge'>
                        <MudChart Class='cardcont2__centerchart' ChartType="ChartType.Bar" ChartSeries="@barChartSeries"
                        @bind-SelectedIndex="index" XAxisLabels="@xAxisLabels" Width='100%' Height='100%'></MudChart>
                    </MudContainer>
                </MudPaper>

                <MudPaper Class='cardcont3' Elevation='0'>
                    <MudContainer Class='cardcont3__subcont' Fixed='false' MaxWidth='MaxWidth.ExtraExtraLarge'
                    style="align-items: center;">
                        <MudText Class='cardcont3__cardtitle'>
                            Ticket Priority
                        </MudText>
                        <MudSpacer />
                        <div class='cardcont3__lblonfooter'>
                            <MudIconButton OnClick='ViewPieChart' Icon="@Icons.Material.Filled.PieChart" aria-label="Analytics"
                            Size='Size.Small' />
                        </div>
                    </MudContainer>
                    <MudContainer Class='cardcont3__subcont' Fixed='false' MaxWidth='MaxWidth.ExtraExtraLarge'>
                        <MudChart Class='cardcont3__piechart' ChartType='ChartType.Pie' InputData='pieDataX'
                        InputLabels='xAxisPieLabels' Width='80%' Height='80%'>
                        </MudChart>
                    </MudContainer>
                    <MudContainer Class='cardcont3__subcont' Fixed='false' MaxWidth='MaxWidth.ExtraExtraLarge'>
                        <div class='cardcont3__expansionpanels'>
                            <MudExpansionPanels Elevation='0'>
                                <MudExpansionPanel Text='@totalTicketsTitle' IsInitiallyExpanded='true'>
                                    <div class='cardcont3__expansionpaneldata'>
                                        @if (GlobalClass.CurrentUserAccount.AccessLevel == Enums.AccessLevel.Administrator)
                                        {
                                            @foreach (var item in itDeptEmpListCB)
                                            {
                                                <MudAvatar
                                        Image='@($"data:image/png;base64, {Convert.ToBase64String(@item.EmployeeDetails.Picture)}")'>
                                                </MudAvatar>
                                                <MudText>
                                                    @item.EmployeeDetails.EmployeeName
                                                </MudText>
                                                <MudText>
                                                    @item.TicketCount
                                                </MudText>
                                            }
                                        }
                                        else
                                        {
                                            <MudAvatar
                                        Image='@($"data:image/png;base64, {Convert.ToBase64String(@GlobalClass.CurrentUserAccount.Picture)}")'>
                                            </MudAvatar>
                                            <MudText>
                                                @GlobalClass.CurrentUserAccount.EmployeeName
                                            </MudText>
                                            <MudText>
                                                @ticketList.Count()
                                            </MudText>
                                        }
                                    </div>
                                </MudExpansionPanel>
                            </MudExpansionPanels>
                        </div>
                    </MudContainer>
                </MudPaper>

                <MudPaper Class='cardcont4' Elevation='0'>
                    <div class="cardcont4__grid">
                        <MudPaper Class="cardcont4-left" Square Elevation='0'>
                            <div class='cardcont4__header'>
                                <p class='header-section'>
                                    @Enums.TicketCategoryType.Hardware
                                </p>
                                <MudSpacer />
                                <p class='header-count'>
                                    @totalHardwareCount
                                </p>
                            </div>
                            <div class='cardcont4__content'>
                                @foreach (var item in ticketCategoryModelCBList)
                                {
                                    if (item.TicketCategory.CategoryTypeId == Enums.TicketCategoryType.Hardware)
                                    {
                                        <p class='content-category'>
                                            @item.CategoryName
                                        </p>
                                        <p class='content-count'>
                                            @item.Count
                                        </p>
                                    }
                                }
                            </div>
                        </MudPaper>
                        <MudPaper Class="cardcont4-center" Square Elevation='0'>
                            <div class='cardcont4__header'>
                                <p class='header-section'>
                                    @Enums.TicketCategoryType.Software
                                </p>
                                <MudSpacer />
                                <p class='header-count'>
                                    @totalSoftwareCount
                                </p>
                            </div>
                            <div class='cardcont4__content'>
                                @foreach (var item in ticketCategoryModelCBList)
                                {
                                    if (item.TicketCategory.CategoryTypeId == Enums.TicketCategoryType.Software)
                                    {
                                        <p class='content-category'>
                                            @item.CategoryName
                                        </p>
                                        <p class='content-count'>
                                            @item.Count
                                        </p>
                                    }
                                }
                            </div>
                        </MudPaper>
                        <MudPaper Class="cardcont4-right" Square Elevation='0'>
                            <div class='cardcont4__header'>
                                <p clas='header-section'>
                                    @Enums.TicketCategoryType.Admin
                                </p>
                                <MudSpacer />
                                <p class='header-count'>
                                    @totalAdminCount
                                </p>
                            </div>
                            <div class='cardcont4__content'>
                                @foreach (var item in ticketCategoryModelCBList)
                                {
                                    if (item.TicketCategory.CategoryTypeId == Enums.TicketCategoryType.Admin)
                                    {
                                        <p class='content-category'>
                                            @item.CategoryName
                                        </p>
                                        <p class='content-count'>
                                            @item.Count
                                        </p>
                                    }
                                }
                            </div>
                        </MudPaper>
                    </div>
                </MudPaper>
            }
        </MudContainer>
    </MudPaper>
</div>