@page "/settings/ticket/branch"

@inherits TicketBranchBase
@attribute [Authorize]

<div class='page-cont'>
    @if (!dataFetched)
    {
        <SkeletonDefaultList />
    }
    else
    {
        <div class='pa-2'>
            <MudTable Class='table-sm-type' ServerData='new Func<TableState, Task<TableData<TicketBranchModel>>>(LoadBranches)' Hover
                FixedHeader FixedFooter RowsPerPage='15' Breakpoint="Breakpoint.Xs" Bordered Dense LoadingProgressColor="Color.Primary"
                Height='calc(100vh - 195px)' @ref='tableVariable'>
                <ToolBarContent>
                    <MudGrid Spacing='1'>
                        <MudItem xs=4>
                            <MudTextField Class='mb-2' T='string' Placeholder='Search' Adornment='Adornment.Start' AdornmentIcon='@Icons.Material.Filled.Search' IconSize='Size.Small'
                                Clearable Margin='Margin.Dense' ValueChanged='(text => OnSearch(text))'/>
                        </MudItem>
                        <MudItem Class='d-flex align-center justify-end' xs=8>
                            <MudTooltip Text='Refresh table' Arrow>
                                <MudIconButton Class='@(isTableLoading ? "mudbtnico-rotate":"")' OnClick='(() => ReloadTable())' Size='Size.Small' Icon="@Icons.Material.Filled.Refresh" Color='@(isTableLoading ? Color.Info : Color.Default)'
                                    aria-label="Refresh" />
                            </MudTooltip>
                            <MudMenu Class='mudbtnico-rotate-90' Label='More' StartIcon="@Icons.Material.Filled.MoreVert" Dense AnchorOrigin='Origin.BottomCenter' TransformOrigin='Origin.TopRight' ActivationEvent='MouseEvent.MouseOver'
                                Size='Size.Small'>
                                <MudMenuItem OnClick="(()=> AddTicketBranch())">
                                    <div class='d-flex align-center gap-2'>
                                        <MudIcon Icon='@Icons.Material.Filled.Add' Size='Size.Small' />
                                        <MudText Typo='Typo.body2'>
                                            Add Branch
                                        </MudText>
                                    </div>
                                </MudMenuItem>
                            </MudMenu>
                        </MudItem>
                    </MudGrid>
                </ToolBarContent>
                <ColGroup>
                    <col />
                    <col style="width:50px"/>
                    <col style="width:50px"/>
                </ColGroup>
                <HeaderContent>
                    <MudTh>
                        <MudTableSortLabel InitialDirection='SortDirection.Ascending' SortBy='new Func<TicketBranchModel, object>(x=>x.BranchName)'>
                            <small class='txt-uppercase'>Branch Name</small>
                        </MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <small class='txt-uppercase'>Active</small>
                    </MudTh>
                    <MudTh>
                        <small class='txt-uppercase'>Actions</small>
                    </MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel='BranchName'>
                        <div class='d-flex align-center'>
                            <MudIcon Icon='@Icons.Material.Filled.LocationOn' Title='Location' Size='Size.Small' />
                            <small>@context.BranchName</small>
                        </div>
                    </MudTd>
                    <MudTd DataLabel='IsActive'>
                        <div class='d-flex align-center justify-center gap-2'>
                            <MudCheckBox @bind-Checked='@context.IsActive'  Dense ReadOnly Size='Size.Small'/>
                        </div>
                    </MudTd>
                    <MudTd DataLabel='Actions'>
                        <MudMenu Class='mudbtnico-rotate-90' Icon="@Icons.Material.Filled.MoreVert" Dense AnchorOrigin='Origin.BottomCenter' TransformOrigin='Origin.TopRight' ActivationEvent='MouseEvent.MouseOver'
                            Size='Size.Small'>
                            <MudMenuItem OnClick="(() => EditTicketBranch(context))">
                                <div class='d-flex align-center gap-2'>
                                    <MudIcon Icon='@Icons.Material.Filled.Edit' Size='Size.Small' />
                                    <MudText Typo='Typo.body2'>Modify Branch</MudText>
                                </div>
                            </MudMenuItem>
                        </MudMenu>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager PageSizeOptions='new int[]{15,30,45,60,75,90,100}' />
                </PagerContent>
            </MudTable>
        </div>
    }
</div>